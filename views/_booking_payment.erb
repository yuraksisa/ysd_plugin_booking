   <form name="form-payment" id="form-payment" action="/p/booking/pay" method="POST">
   	  <input type="hidden" name="id" value="<%=booking.id%>"/>
      <h3 class="guiblock-title"><%=t.booking.payment.label%></h3>
      <% if booking.total_paid == 0 %>
        <div class="formrow">
          <% if booking_deposit > 0 %>
            <div class="radio-block">
              <input type="radio" name="payment" value="total" checked="true"><%=t.booking.payment_type.total.label%></input>
              <p class="radio-info less_contrast_text"><%= "%.2f €" % booking.total_cost%></p>
            </div>
            <div class="radio-block">
              <input type="radio" name="payment" value="deposit"><%=t.booking.payment_type.deposit.label%></input>
              <p class="radio-info less_contrast_text"><%= "%.2f €" % booking.booking_amount%></p>
            </div>
          <% else %>
            <input type="hidden" name="payment" value="total"/>
            <p><%= t.booking.payment.description("%.2f €" % booking.total_cost)%></p>
          <% end %>
        </div>
      <% else %>
        <div class="formrow">
          <input type="hidden" name="payment" value="pending"/>
          <p><%= t.booking.pending_payment.description("%.2f €" % booking.total_pending)%></p>
        </div>
      <% end %>
      <div class="formrow">
        <div id="payment_methods">
          <h4 class="top-margin bottom-margin"><%=t.booking.payment_method%></h4>
          <div id="payment_methods_selector"></div>
        </div>
      </div>
      <div class="formrow-botonera top-separator top-margin top-space">
        <input type="submit" value="Pagar"/>
      </div>
   </form>

<script type="text/javascript">

require (['jquery','YSDListSelector', 'YSDRemoteDataSource', 'jquery.validate',
	      'jquery.ui'],
 	     function($, ListSelector, RemoteDataSource) {

   paymentView = {
       
       init: function() {

          this.configurePaymentMethods();
          this.configureValidations();

       },

       configurePaymentMethods: function() {
          
          var paymentMethodsDS = new RemoteDataSource('/paymethods/online', 
          	{id:'id', description: function(data){
          	  var img = (data.icon && data.icon.length > 0)?'<img src="'+ data.icon + '"/>':'';	
          	  img += '<span class="highlighted_text">' + 
          	    data.title +'</span><div class="lighter_text">' + data.description + '</div>';
          	  return img;} 
          	});
          
          var paymentMethods = new ListSelector('payment_methods_selector',
          	'payment_method_id', paymentMethodsDS, null, false);

       },

       configureValidations: function() {

        $('#form-payment').validate({

          invalidHandler : function (form, validator) {
      
            $('<div title="<%=t.new_booking.form_errors.title%>"><%=t.new_booking.form_errors.description%></div>').dialog( { height: 260, modal: true,     	 
       	        buttons: {
       	            Ok: function() {
				   	  $( this ).dialog( "close" );
       	            }
       	        } 
       	      });
      
          },
  
          rules : {
        	'payment_method_id' : {
        		required: true
        	}
          },

          messages : {
        	'payment_method_id': {
        		required: '<%=t.new_booking.payment_method.required%>'
        	}
          },

       	  errorPlacement : function(error, element) {
       	    	
       	  	if (element.attr('name') === 'payment_method_id') {
       	   	  error.insertAfter('#payment_methods');
       	   	}          
          
          }

        });
       }

   };

   paymentView.init();
 
});

</script>
