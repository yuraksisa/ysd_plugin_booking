require(['jquery','charts'], function($, Chart) {

  dashboardModel = {

    reservationsByDayData : {
      labels: ["L", "M", "X", "J", "V", "S", "D"],
        datasets: [
          {
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(220,220,220,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [ <% @reservations_by_weekday.each do |key,value| %><%=value%>,<%end%>]                  
          }
        ]
    },

    reservationsByCategoryData : [
      <% @reservations_by_category.each do |key, value| %>
      {
        value: <%=value[:value]%>,
        color: '<%=value[:color]%>',
        hightlight: '<%=value[:highlight]%>',
        label: '<%=value[:label]%>'
      },
      <% end %>
    ],
    reservationsByStateData : [
      <% @reservations_by_status.each do |key, value| %>
      {
        value: <%=value[:value]%>,
        color: '<%=value[:color]%>',
        hightlight: '<%=value[:highlight]%>',
        label: '<%=value[:label]%>'
      },
      <% end %>
    ],

   last30DaysReservationsData : {
     labels: [<% @last_30_days_reservations.each do |key, value|%><%=key%>,<%end%>],
     datasets: [
        {
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: [<% @last_30_days_reservations.each do |key, value| %><%=value%>,<%end%>
                   ]
        }
     ]
    }

  }

  dashboardView = {

    init: function() {
      // Reservations by Day
      
  	  var reservationsByDayCtx = document.getElementById("reservations_by_day_graphic").getContext("2d");
      var reservationsByDayOptions = { //String - A legend template
        legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\"><%% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%%=segments[i].fillColor%>\"></span><%%if(segments[i].label){%><%%=segments[i].label%><%%}%></li><%%}%></ul>"
      };
      var reservationsByDayChart = new Chart(reservationsByDayCtx).Bar(dashboardModel.reservationsByDayData,reservationsByDayOptions);
      

      // Reservations by category
  	  var reservationsByCategoryCtx = document.getElementById("reservations_by_category_graphic").getContext("2d");
      var reservationsByCategoryOptions = { //String - A legend template
        legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\"><%% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%%=segments[i].fillColor%>\"></span><%%if(segments[i].label){%><%%=segments[i].label%><%%}%></li><%%}%></ul>"
      };
      var reservationsByCategoryChart = new Chart(reservationsByCategoryCtx).Doughnut(dashboardModel.reservationsByCategoryData,reservationsByCategoryOptions);

      // Reservations by state
  	  var reservationsByStateCtx = document.getElementById("reservations_by_state_graphic").getContext("2d");
      var reservationsByStateOptions = { //String - A legend template
        legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\"><%% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%%=segments[i].fillColor%>\"></span><%%if(segments[i].label){%><%%=segments[i].label%><%%}%></li><%%}%></ul>"
      };
      var reservationsByStateChart = new Chart(reservationsByStateCtx).Doughnut(dashboardModel.reservationsByStateData,reservationsByStateOptions);

      // Last 30 days reservations 
  	  var last30DaysReservationsCtx = document.getElementById("last_30_days_reservations_graphic").getContext("2d");
      var last30DaysReservationsOptions = { //String - A legend template
        legendTemplate : "<ul class=\"<%%=name.toLowerCase()%>-legend\"><%% for (var i=0; i<segments.length; i++){%><li><span style=\"background-color:<%%=segments[i].fillColor%>\"></span><%%if(segments[i].label){%><%%=segments[i].label%><%%}%></li><%%}%></ul>"
      };
      var last30DaysReservationsChart = new Chart(last30DaysReservationsCtx).Line(dashboardModel.last30DaysReservationsData,last30DaysReservationsOptions);


    }

  }

  dashboardView.init();
});